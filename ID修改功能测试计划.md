# 自定义植物ID修改功能 - 测试计划

## 功能概述
在植物管理界面添加了编辑自定义植物ID的功能，包括：
- ID编辑输入框（仅编辑模式显示）
- ID唯一性验证（不能与现有植物冲突）
- ID变更警告（可能影响游戏引用）
- 完整的CRUD操作支持

## 实现位置

### 文件修改
1. **src/components/PlantManager/PlantForm.vue**
   - 添加ID输入字段（第7-27行）
   - ID变更检测逻辑（第95-108行）
   - ID验证和确认逻辑（第138-182行）

2. **src/data/customPlants.js**
   - `checkPlantIdExists()` - ID唯一性验证（第109-141行）
   - `updateCustomPlantId()` - ID更新函数（第358-432行）

3. **src/components/PlantManager/index.vue**
   - `handleSave()` - 集成ID变更逻辑（第367-398行）

## 测试用例

### 1. 基础功能测试

#### TC1: 新建植物（ID字段不显示）
- **步骤**: 打开植物管理 → 点击"新建植物"
- **预期**: 不显示ID输入框（仅编辑模式显示）
- **结果**: ✅ PASS / ❌ FAIL

#### TC2: 编辑植物（ID字段显示）
- **步骤**: 选择一个自定义植物 → 点击编辑
- **预期**: 显示ID输入框，填充当前ID
- **结果**: ✅ PASS / ❌ FAIL

### 2. ID修改检测测试

#### TC3: ID未修改状态
- **步骤**: 编辑植物 → 不修改ID → 查看UI
- **预期**: 输入框边框为灰色，无"已修改"标签
- **结果**: ✅ PASS / ❌ FAIL

#### TC4: ID已修改状态
- **步骤**: 编辑植物 → 修改ID → 查看UI
- **预期**: 输入框边框变黄色，显示"已修改"标签
- **结果**: ✅ PASS / ❌ FAIL

### 3. 验证测试

#### TC5: ID为空验证
- **步骤**: 编辑植物 → 清空ID → 点击保存
- **预期**: 弹出提示"植物ID不能为空"
- **结果**: ✅ PASS / ❌ FAIL

#### TC6: ID重复验证（自定义植物）
- **步骤**:
  1. 创建自定义植物A（ID: `custom_test_1`）
  2. 创建自定义植物B（ID: `custom_test_2`）
  3. 编辑植物B → 将ID改为 `custom_test_1` → 保存
- **预期**: 弹出提示"植物ID 'custom_test_1' 已存在，请使用其他ID"
- **结果**: ✅ PASS / ❌ FAIL

#### TC7: ID重复验证（内置植物）
- **步骤**: 编辑自定义植物 → 将ID改为 `peashooter`（内置植物ID）→ 保存
- **预期**: 弹出提示"植物ID 'peashooter' 已存在，请使用其他ID"
- **结果**: ✅ PASS / ❌ FAIL

#### TC8: ID修改确认
- **步骤**: 编辑植物 → 修改ID为有效的新ID → 保存
- **预期**: 弹出确认对话框"确定将植物ID从 'xxx' 修改为 'yyy'？"
- **结果**: ✅ PASS / ❌ FAIL

### 4. 数据持久化测试

#### TC9: ID修改成功
- **步骤**:
  1. 创建自定义植物（记录原ID）
  2. 编辑并修改ID为新值
  3. 保存
  4. 刷新页面
  5. 重新编辑该植物
- **预期**: 植物ID已更新为新值，且修改后持久化
- **结果**: ✅ PASS / ❌ FAIL

#### TC10: 植物列表更新
- **步骤**:
  1. 编辑植物并修改ID
  2. 保存
  3. 观察左侧植物列表
- **预期**: 列表刷新，显示更新后的植物
- **结果**: ✅ PASS / ❌ FAIL

### 5. 边界情况测试

#### TC11: 同时修改ID和其他字段
- **步骤**: 编辑植物 → 修改ID + 名称 + 描述 → 保存
- **预期**: 所有字段都成功更新，ID也成功修改
- **结果**: ✅ PASS / ❌ FAIL

#### TC12: ID包含特殊字符
- **步骤**: 编辑植物 → 将ID改为 `custom@test#123` → 保存
- **预期**: 允许保存（IndexedDB支持字符串key）
- **结果**: ✅ PASS / ❌ FAIL

#### TC13: 长ID
- **步骤**: 编辑植物 → 将ID改为很长的字符串（100+字符）→ 保存
- **预期**: 允许保存（IndexedDB无长度限制）
- **结果**: ✅ PASS / ❌ FAIL

### 6. 错误恢复测试

#### TC14: 取消ID修改
- **步骤**:
  1. 编辑植物 → 修改ID
  2. 点击"取消"按钮
  3. 重新编辑同一植物
- **预期**: ID仍为原值，未保存修改
- **结果**: ✅ PASS / ❌ FAIL

#### TC15: 确认对话框取消
- **步骤**: 编辑植物 → 修改ID → 保存 → 在确认对话框点击"取消"
- **预期**: 返回编辑界面，ID未修改
- **结果**: ✅ PASS / ❌ FAIL

### 7. 并发测试

#### TC16: 修改ID为另一个正在编辑的植物的ID
- **步骤**:
  1. 打开两个浏览器窗口
  2. 窗口A：编辑植物A
  3. 窗口B：编辑植物B，将ID改为植物A的ID
  4. 窗口B保存 → 窗口A保存
- **预期**: 窗口B保存成功，窗口口A保存时提示ID冲突
- **结果**: ✅ PASS / ❌ FAIL

## 测试数据准备

### 测试植物
```javascript
{
  id: 'custom_test_1',
  name: '测试植物1',
  description: '用于测试ID修改功能',
  type: 'shooter',
  imageData: Blob对象
}

{
  id: 'custom_test_2',
  name: '测试植物2',
  description: '用于测试ID冲突检测',
  type: 'producer',
  imageData: Blob对象
}
```

## 测试环境

- **浏览器**: Chrome / Firefox / Edge / Safari
- **Node版本**: v18+
- **URL**: http://localhost:3003

## 已知限制

1. **仅支持自定义植物**: 内置植物无法编辑，因此无法修改ID
2. **游戏引用风险**: 如果ID正在游戏中使用，修改后可能导致引用错误
3. **IndexedDB依赖**: 使用"删除旧记录 + 创建新记录"的方式实现ID变更

## 执行清单

- [ ] 基础功能测试 (TC1-TC2)
- [ ] ID修改检测测试 (TC3-TC4)
- [ ] 验证测试 (TC5-TC8)
- [ ] 数据持久化测试 (TC9-TC10)
- [ ] 边界情况测试 (TC11-TC13)
- [ ] 错误恢复测试 (TC14-TC15)
- [ ] 并发测试 (TC16)

## 测试结果模板

| 用例ID | 测试项 | 预期结果 | 实际结果 | 状态 |
|--------|--------|----------|----------|------|
| TC1 | 新建植物不显示ID字段 | 不显示ID输入框 |  |  |
| TC2 | 编辑植物显示ID字段 | 显示ID输入框 |  |  |
| TC3 | ID未修改无提示 | 灰色边框，无标签 |  |  |
| TC4 | ID已修改有提示 | 黄色边框，"已修改"标签 |  |  |
| TC5 | ID为空验证 | "植物ID不能为空" |  |  |
| TC6 | ID冲突验证（自定义） | "ID已存在"提示 |  |  |
| TC7 | ID冲突验证（内置） | "ID已存在"提示 |  |  |
| TC8 | ID修改确认 | 确认对话框 |  |  |
| TC9 | ID修改成功持久化 | 刷新后ID为新值 |  |  |
| TC10 | 植物列表自动刷新 | 显示更新后的植物 |  |  |

## 测试备注

（记录测试过程中发现的问题、bug或改进建议）

---

**测试人员**: ___________
**测试日期**: ___________
**测试版本**: v1.0.0
